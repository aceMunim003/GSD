<!DOCTYPE html>
<HTML>
   <HEAD>
   	<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.2.2/jquery.min.js"></script>
      <TITLE>
         Warehouse webclient
      </TITLE>

    <style>

	*{
		margin:0px;
		padding:0px;
		font-family:"Arial", Gadget, sans-serif;
	}

    #topBar{
    	margin:0px;
    	padding-left: 40px;
    	padding-top: 25px;
    	position: absolute;
    	top:0;
    	height: 100px;
    	width: 100%;
    	background-color: #35372F;
    	border-bottom: 5px solid #101411;
    	color:#948B55;
    	font-family:"Arial Black", Gadget, sans-serif;
    	font-size:50px;
    }

    .robot{
    	font-family:Arial;
    	font-weight: bold;
    	color:white;
    	text-align: center;
    	padding-top: 10px;
    	width:42px;
    	height: 32px;
    	border: 3px solid black;
    	border-radius: 25px;
    	background-color: red;
    	-webkit-user-select: none; /* Chrome/Safari */        
		-moz-user-select: none; /* Firefox */
		-ms-user-select: none; /* IE10+ */

    }

   	.robot:hover{
   		background-color:#ff6666;
   		cursor: pointer;
   	}

    #r1{
    	position: absolute;
    	z-index: 15;
    }

    #r2{
    	position: absolute;
    	z-index: 15;
    }

	#live_stream{
		width:300px;
		height:300px;
		text-align: center;
		border:1px solid black;
		position: absolute;
		top:200px;
		left:150px;
	}	

	#mapWrapper{
		position: absolute;
		left:600px;
		top:200px;
	}

	#mapWrapper div{
		position: absolute;
		
	}

	table{
		position: relative;
		z-index: 10;
	}

	td{ 
		z-index: 100;
		width:50px;
		height:50px;
		text-align: center;
		color:#16301D;
		-webkit-user-select: none; /* Chrome/Safari */        
		-moz-user-select: none; /* Firefox */
		-ms-user-select: none; /* IE10+ */
		background-color: #16301D;
	}
	td:hover{
		background-color: #9C914D;
		color: #9C914D;
	}

	.section{
		background-color: #2C2F21;
		color:#2C2F21;
		width:46px;
		height:46px;
		border:1px solid black;

	}

	.section:hover{
		cursor: pointer;
		background-color: #494B42;
		color:#494B42;
	}

	#orderBar{
		display: none;
		position: absolute;
		left:596px;
		top:600px;
		width:370px;
		text-align: center;
	}
		#submitButton{
			position: absolute;
			top:250px;
			left:130px;	
			background-color: #97BA1C;
			color: #151908;
			display:none;
		}

		#submitButton:hover{
			background-color: #98A765;
		}

		.buttons{
			display: inline-block;
			background-color: #0D2213;
			-webkit-border-radius: 28;
			-moz-border-radius: 28;
			border-radius: 28px;
			font-family: Arial;
			color: #948B55;
			font-size: 20px;
			padding: 10px 20px 10px 20px;
			text-decoration: none;
		}

		.buttons:hover{
			background-color:#0F431D ;
			text-decoration: none;
			cursor:pointer;
		}
		
		#chosenRobot{
			margin-bottom: 10px;
		}

		#tooltip{
			font-style: italic;
		}
		
	#inspector{
		position: absolute;
		left:1000px;
		top:200px;
		width:400px;
		height:400px;
		/*border:1px solid black; */

	}
	#sectionInfo{
		display: none;
		margin-top:5px;
	}

	#good{
		display: none;
	}
	</style>

   </HEAD>
<BODY>
	<div id="topBar">Warehouse Client v1.0</div>
   	<div id="live_stream">Put live-stream here</div>

   	<div id="mapWrapper">
		<div class="robot" id="r1">R1</div>
		<!-- <div class="robot" id="r2">R2</div> -->
	   	<table id="mapTable" cellspacing="0">
			<tr>
				<td>0,6</td>
				<td>1,6</td>
				<td>2,6</td>
				<td>3,6</td>
				<td>4,6</td>
				<td>5,6</td>
				<td>6,6</td>
			</tr>
			<tr>
				<td>0,5</td>
				<td class="section">1,5</td>
				<td class="section">2,5</td>
				<td >3,5</td>
				<td class="section">4,5</td>
				<td class="section">5,5</td>
				<td>6,5</td>
			</tr>
			<tr>
				<td>0,4</td>
				<td class="section">1,4</td>
				<td class="section">2,4</td>
				<td >3,4</td>
				<td class="section">4,4</td>
				<td class="section">5,4</td>
				<td>6,4</td>
			</tr>
			<tr>
				<td>0,3</td>
				<td>1,3</td>
				<td>2,3</td>
				<td>3,3</td>
				<td>4,3</td>
				<td>5,3</td>
				<td>6,3</td>
			</tr>
			<tr>
				<td>0,2</td>
				<td class="section">1,2</td>
				<td class="section">2,2</td>
				<td >3,2</td>
				<td class="section">4,2</td>
				<td class="section">5,2</td>
				<td>6,2</td>
			</tr>
			<tr>
				<td>0,1</td>
				<td class="section">1,1</td>
				<td class="section">2,1</td>
				<td >3,1</td>
				<td class="section">4,1</td>
				<td class="section">5,1</td>
				<td>6,1</td>
			</tr>
			<tr>
				<td>0,0</td>
				<td>1,0</td>
				<td>2,0</td>
				<td>3,0</td>
				<td>4,0</td>
				<td>5,0</td>
				<td>6,0</td>
			</tr>
		</table>
	</div>

   	<div id="inspector">
   		<h1>Inspector</h1>
   		<h2 id="chosenSection">Section:</h2>
   		<div id="sectionInfo">
   			<span id="sectionStatus"></span><br/>
   			<span id="sectionTemperature"></span><br/>
   			<span id="sectionLighting"></span><br/><br/>
   			
   			<div id="good">
	   			<span id="goodName"></span><br/>
	   			<span id="desTemperature"></span><br/>
	   			<span id="desLighting"></span>
	   		</div>
   		</div>

   	</div>

   	<div id="orderBar">
   		<h2 id="chosenRobot"></h2>
   		<div class="buttons" id="moveButton">Move</div>
   		<!-- <div class="buttons" id="getGoodButton">Get good</div> -->
   		<div class="buttons" id="placeGoodButton">Place good</div><br/>
   		<h2 id="order" style="margin-top:20px;"></h2>
   		<span id="tooltip"></span>
   		<div class="buttons" id="submitButton">Submit</div>
   	</div>

	<script>
	var moveOrder = false;
	var hasGood = false;
	var placeGoodOrder = false;
	var orderDone = false;
	var moveCoordinate;
	var toCoordinate;
	var fromCoordinate;

	window.setInterval(function(){
		$.get( "http://localhost:3000/robots", function( data ) {
        	var robots = JSON.parse(data);
 

        	$('#r1').animate({ "left": ((robots[0].x_coordinate)*50).toString() +'px',"bottom": ((robots[0].y_coordinate)*50).toString() +'px'}, "slow" );
 
        	$('#r2').animate({ "left": ((robots[1].x_coordinate)*50).toString() +'px',"bottom": ((robots[1].y_coordinate)*50).toString() +'px'}, "slow" );
        },"text");
	}, 3000);

	
	$('.section').click(function(){

		var mySection = null;
		var clickedX = this.innerHTML.substring(0,1);
		var clickedY = this.innerHTML.substring(2,3);
		var sections;
        $.get( "http://localhost:3000/db", function( data ) {
        	sections = JSON.parse(data);
        	for (var i = 0; i < sections.length; i++){
  				if (sections[i].x_coord == clickedX && sections[i].y_coord == clickedY ){
  					mySection = sections[i];
  				}
			}
        	if(mySection != null){
				$('#sectionInfo').show();
				$('#chosenSection').html('Section at: (' + mySection.x_coord + ', ' + mySection.y_coord+')');
				$('#sectionStatus').html('Status: ' + mySection.status);
				$('#sectionTemperature').html('Temperature: ' + mySection.temperature + '&degc');
				$('#sectionLighting').html('Lighting: ' + mySection.lighting + ' Lumen');
				if(mySection.good != false){
					$('#good').show()
					$('#goodName').html('Good name: ' + mySection.good.name);
					$('#desTemperature').html('Desired Temperature: ' + mySection.good.desiredTemperature.min + '&degc to ' + mySection.good.desiredTemperature.max + '&degc');
					$('#desLighting').html('Desired Lighting: ' + mySection.good.desiredLighting + ' Lumen');
				}else{
					$('#good').hide()
				}
        	}else{
        		$('#sectionInfo').hide();
        	}
        },"text");
    });

    $('.robot').click( function(e){
		$('#orderBar').show();
		$('#chosenRobot').html('Selected Robot ' + e.target.innerHTML.substring(1,2));
    });
		
	$('#moveButton').click(function() {
		getGoodOrder = false;
		hasGood = false;
		moveOrder = true;
    	$('#order').html('Move robot to coordinate: ');
    	$('#tooltip').html('Select a path tile on the map where you would like the robot to move.');
	});


	$('#placeGoodButton').click(function() {
		moveOrder = false;
		hasGood = false;
    	placeGoodOrder = true;
    	$('#order').html('Make the robot change place of the good on coordinate: (x1,y1) , to coordinate: (x2,y2)');
    	$('#tooltip').html('Select a storage tile on the map where you would like the robot to pick up a good to change its location.');
	});

	$('td').click(function(e) {
		var clickedX = this.innerHTML.substring(0,1);
		var clickedY = this.innerHTML.substring(2,3);
    	if (moveOrder) {
    		if ($(e.target).is('.section')) {
    			alert("The robot can only be moved to path tiles.")
    		} else{
    			moveCoordinate = "("+clickedX+","+clickedY+")"
    			$('#order').html('Move robot to coordinate: '+moveCoordinate+'.');
				$('#submitButton').show();
    		};			
    	}  if (placeGoodOrder) {
    		if (hasGood) {
    			if (!$(e.target).is('.section')) {
	    			alert("Goods can only be placed in storage tiles.");
	    		} else{
	    			toCoordinate = "("+clickedX+","+clickedY+")";
	    			$('#order').html('Make the robot change place of the good on coordinate: '+ fromCoordinate +', to coordinate: '+toCoordinate);
					$('#submitButton').show();
				};
    		} else {
    			if (!$(e.target).is('.section')) {
	    			alert("Goods can only be found in storage tiles.")
	    		} else{
	    			fromCoordinate = "("+clickedX+","+clickedY+")"
	    			$('#order').html('Make the robot change place of the good on coordinate: '+ fromCoordinate +', to coordinate: (x2,y2)');
    				$('#tooltip').html('Select a storage tile on the map where you would like the robot place the good its carrying.');
    				hasGood = true;
	    		};
    		};
    		
    		
    	};
    	
    	

	});

	$('#submitButton').click(function() {
    	$('#order').html('Order submitted!');
    	$('#tooltip').html('');
    	if (moveOrder) {
    		$.get( "http://localhost:3000/robot/"+"move"+moveCoordinate, function( data ) {
        	alert(data);
        },"text");
    	} if (placeGoodOrder) {
    		$.get( "http://localhost:3000/robot/"+"placeGood"+fromCoordinate+","+toCoordinate, function( data ) {
        	alert(data);
        },"text");
    	};
    	moveOrder = false;
		getGoodOrder = false;
		placeGoodOrder = false;
	});

	

	</script>
</BODY>
</HTML>